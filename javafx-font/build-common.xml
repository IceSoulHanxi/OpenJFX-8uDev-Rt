<?xml version="1.0" encoding="UTF-8"?>
<project name="javafx-font-common" default="jar" basedir=".">

  <property name="javafx-font.jni.files" 
 value="com/sun/javafx/font/PrismFontFactory.java
 com/sun/javafx/font/FontConfigManager.java
 com/sun/javafx/font/DFontDecoder.java
 com/sun/javafx/font/MacFontFinder.java
 com/sun/javafx/font/coretext/OS.java
 com/sun/javafx/font/directwrite/OS.java"/>
  
  <property name="cpp.dir" value="../javafx-font-native"/>

  <!-- NOTE: the following properties are passed to the native makefile and
       are overridden by the tv build -->
  <property name="native.dist.dir" value="../javafx-font-native/dist${cross.name.suffix}"/>
  <property name="native.build.dir" value="../javafx-font-native/build${cross.name.suffix}"/>
  <property name="native.makefile" value="Makefile"/>
  <property name="javafx-font.javah.path" value="../javafx-font/build/classes:../javafx-geom/build/classes:../javafx-ui-common/build/classes"/>
  <property name="javafx-font.classes.dir" value="../javafx-font/build/classes"/>
  <property name="nativelib.suffix.macosx" value=".dylib"/>
  
  <target name="get-libname-android" if="isAndroid">
    <property name="native.lib.file" value="libjavafx-font.so"/>
  </target>
  <target name="get-libname-macosx" if="isMacOSX">
    <property name="native.lib.file" value="libjavafx-font${nativelib.suffix.macosx}"/>
  </target>
  <target name="get-libname-linux" if="isLinux">
    <property name="native.lib.file" value="libjavafx-font.so"/>
  </target>
  <target name="get-libname-solaris" if="isSolaris">
    <property name="native.lib.file" value="libjavafx-font.so"/>
  </target>
  <target name="get-libname-windows" if="isWindows">
    <property name="native.lib.file" value="javafx-font.dll"/>
  </target>
  <target name="get-libname-ios" if="isIOS">
    <property name="native.lib.file" value="javafx-font.a"/>
  </target>
  <target name="get-libname" depends="get-libname-android,get-libname-macosx,get-libname-linux,get-libname-solaris,get-libname-windows,get-libname-ios"/>

  <target name="-pre-init" depends="get-libname"/>

  <target name="check-native">
    <uptodate property="native.uptodate" targetfile="${native.dist.dir}/${native.lib.file}" >
      <srcfiles dir= "${cpp.dir}/src" includes="*.c"/>
      <srcfiles dir= "${cpp.dir}/src" includes="*.cpp"/>
      <srcfiles dir= "${cpp.dir}/src" includes="*.h"/>
    </uptodate>
  </target>

  <target name="compile-native" depends="check-native" unless="native.uptodate">
    <ant antfile="build-${os_name}.xml" target="compile-native" inheritAll="true"/>
  </target>

  <target name="jar" depends="init">
    <build-project/>
    <antcall target="compile-native"/>
    <jar destfile="${dist.dir}/javafx-font-native.jar"
         basedir="${native.dist.dir}"
         includes="${native.lib.file}"/>
  </target>

  <target name="test" depends="jar">
    <test-project/>
  </target>

  <target name="test-single" depends="jar">
    <test-single/>
  </target>

  <target name="clean">
    <clean-project/>
    <ant antfile="build-${os_name}.xml" target="clean-native" inheritAll="true"/>
  </target>

</project>
