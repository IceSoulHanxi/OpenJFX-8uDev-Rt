<?xml version="1.0" encoding="UTF-8"?>
<project name="javafx-font" default="all" basedir=".">

  <script language="javascript">
      var files = project.getProperty("javafx-font.jni.files");
      project.setProperty("jni.classes", files.replaceAll("(.)java\\b", ",").replaceAll("/","."));
  </script>
  
  <target name="compile-native" depends="jheaders, amble-fonts">
      <exec executable="${android.ndk}/${ndk.build.cmd}" dir="${cpp.dir}" failonerror="true">
          <arg line="APP_BUILD_SCRIPT=Android.mk NDK_PROJECT_PATH=. TARGET_PLATFORM=${android.ndk.target}"/>
        </exec>
        <copy todir="${native.dist.dir}" flatten="true">
       <fileset dir="../javafx-font-native/libs" includes="${cross.platform.arch}/libjavafx-font.so"/>
       </copy>
  </target>

  <target name="jheaders">
        <echo>Generate jheaders for font t2k support</echo>
        <mkdir dir="${native.build.dir}"/>
     <javah 
         destdir="${native.build.dir}" 
         classpath="${javafx-font.classes.dir}:${javafx-font.javah.path}" force="yes"
         class="${jni.classes}"/>
  </target>

  <target name="amble-fonts" unless="cross.amble-fonts.dontEmbedd">
    <mkdir dir="build/classes/fonts"/>
    <unzip src="${jfx.amble-fonts.jar}" dest="build/classes/fonts">
      <patternset>
        <include name="**/*.ttf"/>
      </patternset>
      <mapper type="flatten"/>
    </unzip>
  </target>

  <target name="clean-native">
      <delete dir="../javafx-font-native/libs"/>
      <delete dir="../javafx-font-native/obj"/>
      <delete dir="../javafx-font-native/build"/>
      <delete dir="../javafx-font-native/dist"/>
  </target>
</project>
