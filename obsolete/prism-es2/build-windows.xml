<?xml version="1.0" encoding="UTF-8"?>
<project name="prism-es2" default="all" basedir=".">

  <import file="../../build-defs.xml"/>

  <property name="jfx.build.needs.visual.studio" value="true"/>
  <property name="jfx.build.needs.make.utility" value="true"/>
  <property name="prism-es2.platform.classes.dir" value="../prism-es2-win/build/classes"/>

  <target name="compile-native" depends="needs-vs-properties">
    <exec executable="cygpath" dir="." outputproperty="short.platform.home" failonerror="true">
      <arg value="-m"/>
      <arg value="-a"/>
      <arg value="-s"/>
      <arg value="${platform.home}"/>
    </exec>
    <get-cygwin-path/>
    <property file="${vs.properties}"/>
    <!-- TODO: reuse do-make macro here -->
    <exec executable="${cmd.utility}" dir="../prism-es2-native" failonerror="true">
      <env key="JDK_HOME" value="${short.platform.home}"/>
      <env key="INCLUDE" value="${windows.vs.INCLUDE}"/>
      <env key="LIB" value="${windows.vs.LIB}"/>
      <env key="LIBPATH" value="${windows.vs.LIBPATH}"/>
      <env key="PATH" value="${windows.vs.PATH}"/>
      <env key="CONF" value="${build.conf}"/>
      <env key="DIST_DIR" value="${native.dist.dir}"/>
      <env key="BUILD_DIR" value="${native.build.dir}"/>
      <env key="PRISMES2_CLASS_DIR" value="${prism-es2.classes.dir}"/>
      <env key="PRISMES2_PLATFORM_CLASS_DIR" value="${prism-es2.platform.classes.dir}"/>
      <env key="PRISM_DEP_CP" value="${prism-common.classes.dir}"/>
      <arg value="/C"/>
      <arg value="${make.utility}"/>
      <arg value="-f"/>
      <arg value="${native.makefile}"/>
      <arg value="all"/>
    </exec>
  </target>

  <target name="clean-native">
    <get-cygwin-path/>
    <!-- TODO: reuse do-make macro here -->
    <exec executable="${cmd.utility}" dir="../prism-es2-native" failonerror="true">
      <env key="DIST_DIR" value="${native.dist.dir}"/>
      <env key="BUILD_DIR" value="${native.build.dir}"/>
      <arg value="/C"/>
      <arg value="${make.utility}"/>
      <arg value="-f"/>
      <arg value="${native.makefile}"/>
      <arg value="clean"/>
    </exec>
  </target>

</project>
