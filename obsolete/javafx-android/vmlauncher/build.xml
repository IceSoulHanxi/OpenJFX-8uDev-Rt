<?xml version="1.0" encoding="UTF-8"?>
<project name="vmlauncher" default="jar" basedir=".">
  <description>Builds javafx-android vmlauncher.</description>

  <property file="project.properties"/>

  <!--  Build with android bootclasspath -->
  <path id="id.android.bootclasspath">
     <pathelement location="${android.sdk}/platforms/${android.target}/android.jar"/>
  </path>
  

  <target name="jheaders" depends="compile">
    <echo>Generate jheaders for vmlauncher</echo>
    <mkdir dir="build/include"/>
    <javah destdir="build/include" 
       classpath="${build.classes.dir}:${android.sdk}/platforms/${android.target}/android.jar" >
       <class name="com.oracle.dalvik.NativePipeReader"/>
       <class name="com.oracle.dalvik.NativePipeReader$StdoutStderrClient"/>
       <class name="com.oracle.dalvik.VMLauncher"/>
    </javah>
  </target>

  <target name="compile">
    <mkdir dir="${build.classes.dir}"/>
    <javac compiler="modern" fork="true"
           srcdir="${src.dir}" 
           destdir="${build.classes.dir}"
           target="1.6"
           source="1.6"
           debug="${javac.debug}" deprecation="${javac.deprecation}"
           bootclasspathref="id.android.bootclasspath"
           includeantruntime="false">
      <classpath>
        <path path="${javac.classpath}"/>
      </classpath>
    </javac>
  </target>

  <target name="compile-native" depends="jheaders">
    <exec executable="${android.ndk}/${ndk.build.cmd}" dir="${basedir}" failonerror="true">
      <arg line="NDK_PROJECT_PATH=. TARGET_PLATFORM=${android.ndk.target}"/>
    </exec>
    <copy todir="${dist.dir}" flatten="true">
      <fileset dir="libs" includes="**/*.*"/>
    </copy>
  </target>

  <target name="jar" depends="compile, compile-native">
    <jar basedir="${build.classes.dir}" destfile="${dist.dir}/${vmlauncher.dist.jar}" compress="false">
      <include name="com/oracle/**/*" />
    </jar>     
  </target>

  <target name="clean">
    <delete dir="bin"/>
    <delete dir="libs"/>
    <delete dir="dist"/>
    <delete dir="obj"/>
    <delete dir="build"/>
  </target>

</project>
