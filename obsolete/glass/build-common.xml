<?xml version="1.0" encoding="UTF-8"?>

<project name="glass-common" default="glass-dist" basedir=".">

    <import file="../build-defs.xml"/>

    <property name="jfxrt.jar" location="${JFXRT_HOME}/lib/ext/jfxrt.jar"/>

    <property name="glass.dist.dir" value="${basedir}/dist"/>
    <property name="glass.dist.bin.dir" value="${glass.dist.dir}/bin"/>
    <property name="glass.dist.lib.dir" value="${glass.dist.dir}/lib"/>

    <target name="init" depends="-init-defs,-init-platform-defs">
      <mkdir dir="${glass.dist.bin.dir}"/>
      <mkdir dir="${glass.dist.lib.dir}"/>
    </target>

    <!-- Build targets... -->

    <target name="build-linux-lens">
      <ant antfile="glass-lib-lens/build.xml" target="default"
           inheritAll="true" useNativeBasedir="true">
        <propertyset id="jfx.build.ant.properties"/>
      </ant>
    </target>

    <target name="build-android" if="isAndroid">
      <ant antfile="glass-lib-lens/build-android.xml" target="jar" inheritAll="false">
        <propertyset id="jfx.build.ant.properties"/>
      </ant>
    </target>

    <target name="build-linux-gtk" unless="cross.glass.dontBuildGlassGTK">
      <ant antfile="glass-lib-gtk/build.xml" target="default"
           inheritAll="true" useNativeBasedir="true">
        <propertyset id="jfx.build.ant.properties"/>
      </ant>
    </target>

    <target name="build-linux" if="isLinux">
      <antcall target="build-linux-gtk"/>
      <antcall target="build-linux-lens"/>
    </target>

    <target name="build-macosx" if="isMacOSX" unless="isCrossPlatform">
      <ant antfile="glass-lib-macosx/build.xml" target="default"
           inheritAll="true" useNativeBasedir="true">
        <propertyset id="jfx.build.ant.properties"/>
      </ant>
    </target>

    <target name="build-ios" if="isIOS">
      <ant antfile="glass-lib-ios/build.xml" target="default"
           inheritAll="true" useNativeBasedir="true">
        <propertyset id="jfx.build.ant.properties"/>
      </ant>
    </target>

    <target name="build-windows" if="isWindows" unless="isCrossPlatform">
      <ant antfile="glass-lib-windows/build.xml" target="default"
           inheritAll="true" useNativeBasedir="true">
        <propertyset id="jfx.build.ant.properties"/>
      </ant>
    </target>

    <target name="build-java">
      <ant antfile="glass/build.xml" target="default"
           inheritAll="true" useNativeBasedir="true">
        <propertyset id="jfx.build.ant.properties"/>
      </ant>
    </target>

    <target name="build-native">
      <antcall target="build-linux"/>
      <antcall target="build-macosx"/>
      <antcall target="build-ios"/>
      <antcall target="build-android"/>
      <antcall target="build-windows"/>
    </target>
    
    <target name="glass-dist" depends="init">
      <antcall target="build-java"/>
      <antcall target="build-native"/>
    </target>

    <target name="deploy" depends="init"/>

    <!-- Clean-up targets... -->

    <target name="clean-linux-gtk">
      <ant antfile="glass-lib-gtk/build.xml" target="clean"
           inheritAll="true" useNativeBasedir="true"/>
    </target>

    <target name="clean-linux-lens">
      <ant antfile="glass-lib-lens/build.xml" target="clean"
           inheritAll="true" useNativeBasedir="true"/>
    </target>
    
    <target name="clean-linux" if="isLinux">
      <antcall target="clean-linux-gtk"/>
      <antcall target="clean-linux-lens"/>
    </target>

    <target name="clean-macosx" if="isMacOSX">
        <ant antfile="glass-lib-macosx/build.xml" target="clean"
             inheritAll="true" useNativeBasedir="true">
          <propertyset id="jfx.build.ant.properties"/>
        </ant>
    </target>
    
    <target name="clean-ios" if="isIOS">
        <ant antfile="glass-lib-ios/build.xml" target="clean"
             inheritAll="true" useNativeBasedir="true">
          <propertyset id="jfx.build.ant.properties"/>
        </ant>
    </target>
    
    <target name="clean-windows" if="isWindows">
      <ant antfile="glass-lib-windows/build.xml" target="clean"
           inheritAll="true" useNativeBasedir="true">
        <propertyset id="jfx.build.ant.properties"/>
      </ant>
    </target>

    <target name="clean-android" if="isAndroid">
   <ant antfile="glass-lib-lens/build-android.xml" target="clean" inheritAll="false"/>
    </target>
    
    <target name="clean">
      <delete dir="${basedir}/dist"/>
      <delete dir="${glass.dist.dir}"/>
      <ant antfile="glass/build.xml" target="clean"
           inheritAll="true" useNativeBasedir="true">
        <propertyset id="jfx.build.ant.properties"/>
      </ant>
      <antcall target="clean-linux"/>
      <antcall target="clean-macosx"/>
      <antcall target="clean-android"/>
      <antcall target="clean-ios"/>
      <antcall target="clean-windows"/>
    </target>
  
    <!-- Targets required by and used by the top repository build... -->

    <target name="jfx-sdk" depends="dist"/>

    <target name="jfx-deploy" depends="deploy"/>

    <target name="jfx-clean" depends="clean"/>

    <target name="jfx-test" depends="test"/>

</project>
