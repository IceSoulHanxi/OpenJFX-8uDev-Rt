<?xml version="1.0" encoding="UTF-8"?>

<project name="glass-lib-gtk" default="default" basedir=".">

    <description>Builds, tests, and runs the project Glass (GTK)</description>

    <property name="jfx.build.needs.gcc.compiler" value="true"/>
    <property name="jfx.build.needs.make.utility" value="true"/>

    <import file="../../../build-defs.xml"/>

    <property name="glass.dist.cross.dir" value="${glass.dist.dir}${cross.name.suffix}"/>
    <property name="glass.dist.cross.bin.dir" value="${glass.dist.cross.dir}/bin"/>

    <property name="jheaders.dir" value="${glass-lib.build.dir}/include"/>

    <property name="glass-lib.build.dir" value="./build${cross.name.suffix}"/>
    <property name="glass-lib.dist.dir" value="./dist${cross.name.suffix}"/>
    <property name="glass-lib.jheaders.dir" value="${glass-lib.build.dir}/include"/>

    <property name="glass.class.dir" value="../glass/build/classes"/>
    
    <target name="default" depends="jheaders,compile-native"/>
    
    <target name="jheaders">
	<mkdir dir="${glass-lib.jheaders.dir}" />
        <javah destdir="${glass-lib.jheaders.dir}" classpath="${glass.class.dir}" force="yes">
            <class name="com.sun.glass.events.DndEvent"/>
            <class name="com.sun.glass.events.KeyEvent"/>
            <class name="com.sun.glass.events.MouseEvent"/>
            <class name="com.sun.glass.events.ViewEvent"/>
            <class name="com.sun.glass.events.WindowEvent"/>
            <class name="com.sun.glass.ui.Application"/>
            <class name="com.sun.glass.ui.Cursor"/>
            <class name="com.sun.glass.ui.Menu"/>
            <class name="com.sun.glass.ui.MenuBar"/>
            <class name="com.sun.glass.ui.MenuItem"/>
            <class name="com.sun.glass.ui.Pixels"/>
            <class name="com.sun.glass.ui.Screen"/>
            <class name="com.sun.glass.ui.Size"/>
            <class name="com.sun.glass.ui.Timer"/>
            <class name="com.sun.glass.ui.View"/>
            <class name="com.sun.glass.ui.View$Capability"/>
            <class name="com.sun.glass.ui.Window"/>
            <class name="com.sun.glass.ui.Window$Level"/>
            <class name="com.sun.glass.ui.gtk.GtkApplication"/>
            <class name="com.sun.glass.ui.gtk.GtkTimer"/>
            <class name="com.sun.glass.ui.gtk.GtkWindow"/>
            <class name="com.sun.glass.ui.gtk.GtkView"/>
            <class name="com.sun.glass.ui.gtk.GtkPixels"/>
            <class name="com.sun.glass.ui.gtk.GtkCursor"/>
            <class name="com.sun.glass.ui.gtk.GtkRobot"/>
            <class name="com.sun.glass.ui.gtk.GtkSystemClipboard"/>
            <class name="com.sun.glass.ui.gtk.GtkCommonDialogs"/>
            <class name="com.sun.glass.ui.gtk.GtkDnDClipboard"/>
            <class name="com.sun.glass.events.WindowEvent"/>
        </javah>
    </target>

    <target name="compile-native-host" unless="cross.platform">
      <exec executable="make" failonerror="true">
        <arg value="JDK_HOME=${platform.home}"/>
        <arg value="DIST_DIR=${glass-lib.dist.dir}"/>
        <arg value="BUILD_DIR=${glass-lib.build.dir}"/>
        <arg value="EXTRA_CFLAGS=${extra_cflags}"/>
        <arg value="EXTRA_LDFLAGS=${extra_ldflags}"/>
        <arg value="all"/>
      </exec>
    </target>

    <target name="compile-native-cross" if="cross.platform">
      <exec executable="make" failonerror="true">
        <arg value="JDK_HOME=${platform.home}"/>
        <arg value="DIST_DIR=${glass-lib.dist.dir}"/>
        <arg value="BUILD_DIR=${glass-lib.build.dir}"/>
        <arg value="EXTRA_CFLAGS=${cross.glass.gtk.cflags}"/>
        <arg value="EXTRA_LDFLAGS=${cross.glass.gtk.ldflags}"/>
        <arg value="CC=${crosstools.gcc}"/>
        <arg value="CXX=${crosstools.gpp}"/>
        <arg value="LINK=${crosstools.gcc}"/>
        <arg value="all"/>
      </exec>
    </target>

    <target name="compile-native" depends="compile-native-host,compile-native-cross">
      <copy todir="${glass.dist.cross.bin.dir}">
        <fileset dir="${glass-lib.dist.dir}"/>
      </copy>
    </target>

    <target name="clean">
	<exec executable="make" failonerror="true">
	  <arg value="clean"/>
          <arg value="DIST_DIR=${glass-lib.dist.dir}"/>
          <arg value="BUILD_DIR=${glass-lib.build.dir}"/>
	</exec>
        <delete dir="${jheaders.dir}"/>
        <delete dir="${glass-lib.dist.dir}"/>
        <delete dir="${glass-lib.build.dir}"/>
        <delete dir="${glass.dist.cross.dir}"/>
    </target>
</project>
