<?xml version="1.0" encoding="UTF-8"?>
<project name="decora-sse" default="all" basedir=".">

  <import file="../../build-defs.xml"/>

  <property name="jfx.build.needs.visual.studio" value="true"/>
  <property name="jfx.build.needs.make.utility" value="true"/>

  <property name="native.dist.dir" value="../decora-sse-native/dist"/>
  <property name="native.build.dir" value="../decora-sse-native/build"/>
  <property name="native.makefile" value="../decora-sse-native/Makefile"/>
  <property name="decora-runtime.class.dir" value="../decora-runtime/build/classes"/>
  <property name="decora-sse.class.dir" value="../decora-sse/build/classes"/>
  <property name="javafx-geom.class.dir" value="../../rt/javafx-geom/build/classes"/>

  <target name="compile-native" depends="needs-vs-properties">
    <exec executable="cygpath" dir="." outputproperty="short.platform.home" failonerror="true">
      <arg value="-m"/>
      <arg value="-a"/>
      <arg value="-s"/>
      <arg value="${platform.home}"/>
    </exec>
    <get-cygwin-path/>
    <property file="${vs.properties}"/>
    <!-- TODO: reuse do-make macro here -->
    <exec executable="${cmd.utility}" dir="../decora-sse-native" failonerror="true">
      <env key="JDK_HOME" value="${short.platform.home}"/>
      <env key="INCLUDE" value="${windows.vs.INCLUDE}"/>
      <env key="LIB" value="${windows.vs.LIB}"/>
      <env key="LIBPATH" value="${windows.vs.LIBPATH}"/>
      <env key="PATH" value="${windows.vs.PATH}"/>
      <env key="CONF" value="${build.conf}"/>
      <env key="DIST_DIR" value="${native.dist.dir}"/>
      <env key="BUILD_DIR" value="${native.build.dir}"/>
      <env key="DECORA_SSE_CLASS_DIR" value="${decora-sse.class.dir}"/>
      <env key="DECORA_DEP_CP" value="${decora-runtime.class.dir}:${javafx-geom.class.dir}"/>
      <arg value="/C"/>
      <arg value="${make.utility}"/>
      <arg value="-f"/>
      <arg value="${native.makefile}"/>
      <arg value="all"/>
    </exec>
  </target>

  <target name="clean-native">
    <get-cygwin-path/>
    <!-- TODO: reuse do-make macro here -->
    <exec executable="${cmd.utility}" dir="../decora-sse-native" failonerror="true">
      <env key="DIST_DIR" value="${native.dist.dir}"/>
      <env key="BUILD_DIR" value="${native.build.dir}"/>
      <arg value="/C"/>
      <arg value="${make.utility}"/>
      <arg value="-f"/>
      <arg value="${native.makefile}"/>
      <arg value="clean"/>
    </exec>
  </target>

</project>
